<div style="min-height: 100vh; background-color: #111827; color: white;">
  <!-- Header -->
  <header style="background-color: #1f2937; border-bottom: 1px solid #374151; padding: 1rem 2rem;">
    <div style="max-width: 72rem; margin: 0 auto; display: flex; justify-content: space-between; align-items: center;">
      <div style="display: flex; align-items: center; gap: 1rem;">
        <!-- Logo -->
        <div style="width: 2.5rem; height: 2.5rem; background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
          <div style="width: 1.25rem; height: 1.25rem; background-color: white; border-radius: 50%;"></div>
        </div>
        <h1 style="font-size: 1.25rem; font-weight: 600; margin: 0;">AI Context Service</h1>
      </div>
      
      <div style="display: flex; align-items: center; gap: 1rem;">
        <span style="color: #9ca3af; font-size: 0.875rem;">Welcome, <%= user.fullName %></span>
        <a href="/logout" style="background-color: #374151; color: white; padding: 0.5rem 1rem; border-radius: 0.375rem; text-decoration: none; font-size: 0.875rem; transition: background-color 0.2s;" onmouseover="this.style.backgroundColor='#4b5563'" onmouseout="this.style.backgroundColor='#374151'">
          Sign Out
        </a>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main style="max-width: 72rem; margin: 0 auto; padding: 2rem;">
    
    <!-- Welcome Section -->
    <div style="background-color: #1f2937; border-radius: 0.5rem; padding: 2rem; margin-bottom: 2rem; border: 1px solid #374151;">
      <h2 style="font-size: 1.5rem; font-weight: 600; margin-bottom: 1rem;">Welcome to Your Dashboard</h2>
      <p style="color: #9ca3af; margin-bottom: 1.5rem;">
        Your personalized AI Context Service is ready. Connect Claude Desktop to your MCP endpoint to get started.
      </p>
      
      <!-- MCP Authentication Info -->
      <div style="background-color: #111827; border-radius: 0.375rem; padding: 1rem; border: 1px solid #4b5563;">
        <h3 style="font-size: 1rem; font-weight: 500; margin-bottom: 1rem;">Your MCP Configuration</h3>
        
        <!-- API Key Display -->
        <div style="margin-bottom: 1rem;">
          <label style="color: #9ca3af; font-size: 0.875rem; margin-bottom: 0.25rem; display: block;">API Key:</label>
          <div style="display: flex; align-items: center; gap: 0.5rem;">
            <code id="mcp-key-display" style="background-color: #374151; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-family: monospace; font-size: 0.875rem; color: #8b5cf6;">
              <%= user.mcpKey ? user.mcpKey.substring(0, 4) + '...' + user.mcpKey.substring(12) : 'Not generated' %>
            </code>
            <button onclick="toggleKeyVisibility()" style="background-color: #6b7280; color: white; padding: 0.25rem 0.5rem; border-radius: 0.25rem; border: none; cursor: pointer; font-size: 0.75rem;">
              Show
            </button>
            <button onclick="regenerateKey()" style="background-color: #dc2626; color: white; padding: 0.25rem 0.5rem; border-radius: 0.25rem; border: none; cursor: pointer; font-size: 0.75rem;">
              Regenerate
            </button>
          </div>
        </div>
        
        <!-- MCP Endpoint Display -->
        <div style="margin-bottom: 1rem;">
          <label style="color: #9ca3af; font-size: 0.875rem; margin-bottom: 0.25rem; display: block;">MCP Endpoint:</label>
          <div style="display: flex; align-items: center; gap: 0.5rem;">
            <code id="mcp-endpoint" style="background-color: #374151; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-family: monospace; font-size: 0.875rem; color: #8b5cf6; word-break: break-all;">
              https://ai-context-service-private.onrender.com/mcp/<%= user.username %>/<%= user.mcpKey || 'key-here' %>
            </code>
            <button onclick="copyEndpoint()" style="background-color: #8b5cf6; color: white; padding: 0.25rem 0.5rem; border-radius: 0.25rem; border: none; cursor: pointer; font-size: 0.75rem;">
              Copy
            </button>
          </div>
        </div>
        
        <!-- Claude Desktop Configuration -->
        <div>
          <label style="color: #9ca3af; font-size: 0.875rem; margin-bottom: 0.25rem; display: block;">Claude Desktop Configuration:</label>
          <button onclick="showClaudeConfig()" style="background-color: #059669; color: white; padding: 0.5rem 1rem; border-radius: 0.25rem; border: none; cursor: pointer; font-size: 0.875rem;">
            Copy Claude Config
          </button>
        </div>
        
        <p style="color: #9ca3af; font-size: 0.875rem; margin-top: 1rem;">
          Use this authenticated endpoint in your Claude Desktop MCP configuration for secure access to your personalized context.
        </p>
      </div>
    </div>

    <!-- Stats Section -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
      
      <!-- Projects Count -->
      <div style="background-color: #1f2937; border-radius: 0.5rem; padding: 1.5rem; border: 1px solid #374151;">
        <div style="display: flex; align-items: center; gap: 1rem;">
          <div style="width: 3rem; height: 3rem; background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
            <span style="color: white; font-weight: 600; font-size: 1.125rem;"><%= user.projects.length %></span>
          </div>
          <div>
            <h3 style="font-size: 1rem; font-weight: 500; margin: 0;">Active Projects</h3>
            <p style="color: #9ca3af; font-size: 0.875rem; margin: 0;">Total projects created</p>
          </div>
        </div>
      </div>

      <!-- Account Status -->
      <div style="background-color: #1f2937; border-radius: 0.5rem; padding: 1.5rem; border: 1px solid #374151;">
        <div style="display: flex; align-items: center; gap: 1rem;">
          <div style="width: 3rem; height: 3rem; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
            <span style="color: white; font-size: 1.125rem;">âœ“</span>
          </div>
          <div>
            <h3 style="font-size: 1rem; font-weight: 500; margin: 0;">Account Active</h3>
            <p style="color: #9ca3af; font-size: 0.875rem; margin: 0;">Ready to use</p>
          </div>
        </div>
      </div>

      <!-- Created Date -->
      <div style="background-color: #1f2937; border-radius: 0.5rem; padding: 1.5rem; border: 1px solid #374151;">
        <div style="display: flex; align-items: center; gap: 1rem;">
          <div style="width: 3rem; height: 3rem; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
            <span style="color: white; font-size: 1.125rem;">ðŸ“…</span>
          </div>
          <div>
            <h3 style="font-size: 1rem; font-weight: 500; margin: 0;">Member Since</h3>
            <p style="color: #9ca3af; font-size: 0.875rem; margin: 0;"><%= new Date(user.created).toLocaleDateString() %></p>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div style="background-color: #1f2937; border-radius: 0.5rem; padding: 2rem; border: 1px solid #374151;">
      <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1.5rem;">Getting Started</h3>
      
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
        
        <!-- Setup Claude Desktop -->
        <div style="background-color: #111827; border-radius: 0.375rem; padding: 1.5rem; border: 1px solid #4b5563;">
          <h4 style="font-size: 1rem; font-weight: 500; margin-bottom: 0.5rem; color: #8b5cf6;">1. Configure Claude Desktop</h4>
          <p style="color: #9ca3af; font-size: 0.875rem; margin-bottom: 1rem;">
            Add your MCP endpoint to Claude Desktop to enable personalized AI interactions.
          </p>
          <a href="#" onclick="showMCPConfig()" style="background-color: #8b5cf6; color: white; padding: 0.5rem 1rem; border-radius: 0.25rem; text-decoration: none; font-size: 0.875rem; display: inline-block;">
            Show Configuration
          </a>
        </div>

        <!-- Create First Project -->
        <div style="background-color: #111827; border-radius: 0.375rem; padding: 1.5rem; border: 1px solid #4b5563;">
          <h4 style="font-size: 1rem; font-weight: 500; margin-bottom: 0.5rem; color: #8b5cf6;">2. Create Your First Project</h4>
          <p style="color: #9ca3af; font-size: 0.875rem; margin-bottom: 1rem;">
            Use Claude Desktop to create your first project and start building context.
          </p>
          <span style="background-color: #374151; color: #9ca3af; padding: 0.5rem 1rem; border-radius: 0.25rem; font-size: 0.875rem;">
            Use Claude Desktop
          </span>
        </div>

      </div>
    </div>

  </main>
</div>

<script>
function copyToClipboard(text) {
  navigator.clipboard.writeText(text).then(function() {
    // Show temporary success message
    const button = event.target;
    const originalText = button.textContent;
    button.textContent = 'Copied!';
    button.style.backgroundColor = '#059669';
    setTimeout(() => {
      button.textContent = originalText;
      button.style.backgroundColor = '#8b5cf6';
    }, 2000);
  });
}

let keyVisible = false;
const fullKey = '<%= user.mcpKey || "" %>';

function toggleKeyVisibility() {
  const keyDisplay = document.getElementById('mcp-key-display');
  const button = event.target;
  
  if (keyVisible) {
    keyDisplay.textContent = fullKey.substring(0, 4) + '...' + fullKey.substring(12);
    button.textContent = 'Show';
    keyVisible = false;
  } else {
    keyDisplay.textContent = fullKey;
    button.textContent = 'Hide';
    keyVisible = true;
  }
}

function copyEndpoint() {
  const endpoint = document.getElementById('mcp-endpoint').textContent;
  navigator.clipboard.writeText(endpoint).then(() => {
    const button = event.target;
    const originalText = button.textContent;
    button.textContent = 'Copied!';
    button.style.backgroundColor = '#059669';
    setTimeout(() => {
      button.textContent = originalText;
      button.style.backgroundColor = '#8b5cf6';
    }, 2000);
  });
}

function showClaudeConfig() {
  const config = `{
  "mcpServers": {
    "ai-context-<%= user.username %>": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-stdio", "https://ai-context-service-private.onrender.com/mcp/<%= user.username %>/<%= user.mcpKey || 'key-here' %>"]
    }
  }
}`;
  
  navigator.clipboard.writeText(config).then(() => {
    alert('Claude Desktop MCP Configuration copied to clipboard!\\n\\nPaste this into your Claude Desktop settings.');
  });
}

async function regenerateKey() {
  if (!confirm('Are you sure you want to regenerate your MCP key? This will invalidate your current Claude Desktop configuration.')) {
    return;
  }
  
  try {
    const response = await fetch('/dashboard/regenerate-key', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' }
    });
    
    const data = await response.json();
    
    if (data.success) {
      // Update the display
      fullKey = data.newKey;
      document.getElementById('mcp-key-display').textContent = data.newKey.substring(0, 4) + '...' + data.newKey.substring(12);
      document.getElementById('mcp-endpoint').textContent = 'https://ai-context-service-private.onrender.com' + data.mcpEndpoint;
      keyVisible = false;
      document.querySelector('button[onclick="toggleKeyVisibility()"]').textContent = 'Show';
      
      alert('MCP key regenerated successfully! Please update your Claude Desktop configuration with the new endpoint.');
    } else {
      alert('Failed to regenerate key. Please try again.');
    }
  } catch (error) {
    alert('Error regenerating key: ' + error.message);
  }
}
</script>